"use strict";

(function(){
    var root = this;
    var prev_bunnycolors = root.bunnycolors;
	var genesis_design = ["000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013315331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013351331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013361331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000011100000.000000000000000114410111.000111000111101444441551.011455111444414441441441.145555544444414414114441.011111444615441444444111.000000114444561444444441.000000114444561444444441.011111444615441444444111.145555544444414414114441.011455111444414441441441.000111000111101444441551.000000000000000114410111.000000000000000011100000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000","00000000000001111000.00000000000111441100.00000000001444444410.00000000014444444411.00000000144441444441.00000000144414444441.00000001444414444441.00000001444414444441.00000001444411444441.00000001444441111115.00000001444444444466.01110001144444444466.01411100144444411111.01455410114444144441.00145541011444444441.00014554144444444441.01111455444441144441.14555114444444114441.01455551444444414415.00111111144564441100.00000000014444441000.00000000014444441000.00000000001114510000.00000000000011100000","00000000000000000000110.00000000000115000001510.00000000001445100014311.00000000014444100143151.00001111144624101431441.00015555144444114314410.00155111444444441144100.01411445444444444441000.14411555444444444410000.11115551111444411100000.00155511001444441000000.01451100014444441000000.01110000144444441000000.00000000144444111100000.00000001444441441410000.00000001444441444141000.00000000144444444141000.00000000144444444144100.00000000014444444414100.00000000014441111414510.00000001141111001441110.00000014441000000144100.00000014441000000014510.00000001110000000001110","000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013316331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000015500000000000.000000001133310000000000.000000013333331000000000.000000013316331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","00000000000001111000.00000000000111441100.00000000001444444410.00000000014444444411.00000000144441444441.00000000144414444441.00000001444414444441.00000001444414444441.00000001444411444441.00000001444441111115.00000001444444444466.01110001144444444466.01411100144444411111.01455410114444144441.00145541011444444441.00014554144444444441.01111455444441144441.14555114444444114441.01455551444444414415.00111111144514441100.00000000014444441000.00000000014444441000.00000000001114510000.00000000000011100000","00000000000001111000.00000000000111441100.00000000001444444410.00000000014444444411.00000000144441444441.00000000144414444441.00000001444414444441.00000001444414444441.00000001444411444441.00000001444441111115.00000001444444444466.01110001144444444466.01411100144444411111.01455410114444144441.00145541011444444441.00014554144444444441.01111455444441144441.14555114444444114441.01455551444444414415.00111111144524441100.00000000014444441000.00000000014444441000.00000000001114510000.00000000000011100000","000000000015500000000000.000000001166610000000000.000000016666661000000000.000000016615661011100000.000011166666661166610011.001166666666666666661161.016555666666666666666611.165556661166666666666610.155561110016666666111111.111110000001666661666161.000000000001166661666661.000000000000166666666661.000000000000166666666661.000000000000166666666661.000000000000166666666661.000000000000016666666661.000000000000001666666661.000000000000000166666610.000000000000000011111110.000000000000000000001661.000000000000000000016661.000000000000000000016611.000000000000000000001110.000000000000000000000000","000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000011100000.000000000000000114410111.000111000111101444441551.011455111444414441441441.145555544444414414114441.011111444615441444444111.000000114444561444444441.000000114444561444444441.011111444615441444444111.145555544444414414114441.011455111444414441441441.000111000111101444441551.000000000000000114410111.000000000000000011100000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000"];
    var designs = ["000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013315331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013351331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013361331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","00000000000001111000.00000000000111441100.00000000001444444410.00000000014444444411.00000000144441444441.00000000144414444441.00000001444414444441.00000001444414444441.00000001444411444441.00000001444441111115.00000001444444444466.01110001144444444466.01411100144444411111.01455410114444144441.00145541011444444441.00014554144444444441.01111455444441144441.14555114444444114441.01455551444444414415.00111111144514441100.00000000014444441000.00000000014444441000.00000000001114510000.00000000000011100000","00000000000000000000110.00000000000115000001510.00000000001445100014311.00000000014444100143151.00001111144624101431441.00015555144444114314410.00155111444444441144100.01411445444444444441000.14411555444444444410000.11115551111444411100000.00155511001444441000000.01451100014444441000000.01110000144444441000000.00000000144444111100000.00000001444441441410000.00000001444441444141000.00000000144444444141000.00000000144444444144100.00000000014444444414100.00000000014441111414510.00000001141111001441110.00000014441000000144100.00000014441000000014510.00000001110000000001110","000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000011100000.000000000000000114410111.000111000111101444441551.011455111444414441441441.145555544444414414114441.011111444615441444444111.000000114444561444444441.000000114444561444444441.011111444615441444444111.145555544444414414114441.011455111444414441441441.000111000111101444441551.000000000000000114410111.000000000000000011100000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000","000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013316331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000015500000000000.000000001133310000000000.000000013333331000000000.000000013316331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","00000000000000111000.00000000000111131100.00000000001333334410.00000000013344444431.00000000133441444431.00000000133414444431.00000001334414444431.00000001344414444431.00000001344431111431.00000001344433333131.00000001344444433331.01110001334444444431.01411100134444411131.01455410133444133331.00145541012344444431.00014554113444444431.01111455444444144431.14554114444444414431.01455551444614414410.00111111144444441100.00000000014444441000.00000000014444441000.00000000001114510000.00000000000011100000","00000000000001111000.00000000000111441100.00000000001444444410.00000000014444444411.00000000144441444441.00000000144414444441.00000001444414444441.00000001444414444441.00000001444411444441.00000001444441111115.00000001444444444466.01110001144444444466.01411100144444411111.01455410114444144441.00145541011444444441.00014554144444444441.01111455444441144441.14555114444444114441.01455551444444414415.00111111144514441100.00000000014444441000.00000000014444441000.00000000001114510000.00000000000011100000","000000000015500000000000.000000001166610000000000.000000016666661000000000.000000016615661011100000.000011166666661166610011.001166666666666666661161.016555666666666666666611.165556661166666666666610.155561110016666666111111.111110000001666661666161.000000000001166661666661.000000000000166666666661.000000000000166666666661.000000000000166666666661.000000000000166666666661.000000000000016666666661.000000000000001666666661.000000000000000166666610.000000000000000011111110.000000000000000000001661.000000000000000000016661.000000000000000000016611.000000000000000000001110.000000000000000000000000","000000000015500000000000.000000001144410000000000.000000014444431000000000.000000014441431011100000.000011144444441133310011.001144554444444334441141.014555443344444444444411.145543331133444444333410.155331110013344443111111.111110000001344441444141.000000000001134441444441.000000000000134444444441.000000000000134444444441.000000000000133444444441.000000000000133344444441.000000000000013334443341.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001441.000000000000000000014431.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000012100000000000.000000001155510000000000.000000015555551000000000.000000015561551011100000.000011155555551155510011.001155555555555555551151.015555555555555555555511.155555551155555555555510.155551110015555555111111.111110000001555551555151.000000000001155551555551.000000000000155555555551.000000000000155555555551.000000000000155555555551.000000000000155555555551.000000000000015555555551.000000000000001555555551.000000000000000155555510.000000000000000011111110.000000000000000000001551.000000000000000000015551.000000000000000000015511.000000000000000000001110.000000000000000000000000","000000000012100000000066.000000001155510000000000.000000015555551000000000.000000015561551011100000.000011155555551155510011.001155555555555555551151.015555555555565555655511.155555551155555565555510.155551110015555555111111.111110000001565551555151.000000000001155551565551.000000000000155555555551.000000000000165655565551.000000000000155555555651.000000000000155555555551.000000000000015555555551.000000000000001556556551.000000000000000155555510.000000000000000011111110.000000000000000000001551.000000000000000000015651.000000000000000000015511.000000000000000000001110.000000000000000000000000","000000000012100000000056.000000001155510000000000.000000011155551000000000.000000011161551011100000.000011155555551151510011.001115555551555515551151.015555155555555155555511.151155551151551555555510.151551110015551555111111.111110000001551551555551.000000000001151551555551.000000000000151555555151.000000000000115515551551.000000000000155515515551.000000000000155515555151.000000000000015115155551.000000000000001555555151.000000000000000155555510.000000000000000011111110.000000000000000000001151.000000000000000000015151.000000000000000000015511.000000000000000000001110.000000000000000000000000","000000000012100000000056.000000001155510000000000.000000011155551000000000.000000011161551011100000.000011155555551151510011.001115555551555515551151.015555155555555155555511.151155551151551555555510.151551110015551555111111.111110000001551551555551.000000000001151551555551.000000000000151555555151.000000000000115515551551.000000000000155515515551.000000000000155515555151.000000000000015115155551.000000000000001555555151.000000000000000155555510.000000000000000011111110.000000000000000000001151.000000000000000000015151.000000000000000000015511.000000000000000000001110.000000000000000000000000"];

    function RGBToHSL(r, g, b) {
	if (Array.isArray(r)) {
	    g = r[1];
	    b = r[2];
	    r = r[0];
	}
	var r = r / 255;
	var g = g / 255;
	var b = b / 255;
	var cMax = Math.max(r, g, b);
	var cMin = Math.min(r, g, b);
	var delta = cMax - cMin;
	if (delta == 0) {
	    var h = 0;
	} else if (cMax == r) {
	    var h = 60 * (((g - b) / delta) % 6);
	} else if (cMax == g) {
	    var h = 60 * ((b - r) / delta + 2);
	} else if (cMax == b) {
	    var h = 60 * ((r - g) / delta + 4);
	}
	if (h < 0) {
	    h += 360;
	}
	var l = (cMax + cMin) / 2;

	if (delta == 0) {
	    var s = 0;
	} else {
	    var s = delta / (1 - Math.abs(2 * l - 1));
	}

	return [h, s, l]
    }

    function HSLToRGB(h, s, l) {
	if (Array.isArray(h)) {
	    s = h[1];
	    l = h[2];
	    h = h[0];
	}
	var c = (1 - Math.abs(2 * l - 1)) * s;
	var x = c * (1 - Math.abs((h / 60) % 2 - 1));
	var m = l - c / 2;
	if (h >= 0 && h < 60) {
	    var r = c,
		g = x,
		b = 0;
	} else if (h >= 60 && h < 120) {
	    var r = x,
		g = c,
		b = 0;
	} else if (h >= 120 && h < 180) {
	    var r = 0,
		g = c,
		b = x;
	} else if (h >= 180 && h < 240) {
	    var r = 0,
		g = x,
		b = c;
	} else if (h >= 240 && h < 300) {
	    var r = x,
		g = 0,
		b = c;
	} else if (h >= 300 && h < 360) {
	    var r = c,
		g = 0,
		b = x;
	}
	r = Math.round((r + m) * 255);
	g = Math.round((g + m) * 255);
	b = Math.round((b + m) * 255);
	return [r, g, b];
    }

    function RGBToHex(arr) {
	var r = arr[0],
	    g = arr[1],
	    b = arr[2];
	return "#" + ("0" + r.toString(16)).slice(-2) + ("0" + g.toString(16)).slice(-2) + ("0" + b.toString(16)).slice(-2);
    }

    function derivePalette(r, g, b, invert) {
	var hsl = RGBToHSL(r, g, b);

	var h = hsl[0];
	var s = hsl[1];
	var l = hsl[2];
	var hx = h % 360;
	var hy = (h + 320) % 360;

	var c1 = HSLToRGB(hx, 1, 0.1);
	if (invert) {
	    var c4 = HSLToRGB(hx, 1, 0.2);
	    var c5 = HSLToRGB(hx, 1, 0.45);
	    var c2 = HSLToRGB(hx, 1, 0.7);
	    var c3 = HSLToRGB(hy, 1, 0.8);
	} else {
	    var c2 = HSLToRGB(hx, 1, 0.2);
	    var c3 = HSLToRGB(hx, 1, 0.45);
	    var c4 = HSLToRGB(hx, 1, 0.7);
	    var c5 = HSLToRGB(hy, 1, 0.8);

	}


	return [
	    null,
	    RGBToHex(c1),
	    RGBToHex(c2),
	    RGBToHex(c3),
	    RGBToHex(c4),
	    RGBToHex(c5)
	];
    }

	function random(max) {
		return Math.floor(Math.random() * max) + 1;
	}
		
    function hexToBytes(hex){
	var result = []
	for(var i = 0; i < hex.length; i+=2){
	    result.push(parseInt(hex.slice(i, i+2),16));
	}
	return result;
    }

    var bunnycolors = function (bunnyid){
	if(bunnyid.slice(0,2) == "df"){
	    bunnyid = bunnyid.slice(2);
		console.log("Sliced " + bunnyid);
	}
	var bytes = hexToBytes(bunnyid);
	var genesis = bytes[0],
	    k = bytes[1],
	    r = bytes[2],
	    g = bytes[3],
	    b = bytes[4];

	var size = size || 10;
	var invert = k >= 128;
	k = k % 128;

	k = random(designs.length-1); // Number of the Cat
	var design = designs[k].split(".");
	console.log(k);
	console.log(design);
	var colors;
	if(genesis){
		k = random(genesis_design.length-1);
		design = genesis_design[k].split(".");

	    if(k % 2 === 0 && invert || k % 2 === 1 && !invert){
		colors = [null, "#555555", "#d3d3d3", "#ffffff", "#000000", "#ff9999"];
	    }else{
		colors = [null, "#555555", "#222222", "#111111", "#000000", "#ff9999"];
	    }
	}else{
	    colors = derivePalette(r, g, b, invert);
	}

		return colors;
    }

    bunnycolors.noConflict = function(){
	root.bunnycolors = prev_bunnycolors;
	return bunnycolors;
    }

    if( typeof exports !== 'undefined' ) {
	if( typeof module !== 'undefined' && module.exports ) {
	    exports = module.exports = bunnycolors;
	}
	exports.bunnycolors = bunnycolors;
    } else {
	root.bunnycolors = bunnycolors;
    }
}).call(this);
