"use strict";

(function(){
    var root = this;
    var prev_mooncatparser = root.mooncatparser;
	var genesis_design = ["000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013315331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013351331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013361331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000011100000.000000000000000114410111.000111000111101444441551.011455111444414441441441.145555544444414414114441.011111444615441444444111.000000114444561444444441.000000114444561444444441.011111444615441444444111.145555544444414414114441.011455111444414441441441.000111000111101444441551.000000000000000114410111.000000000000000011100000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000","00000000000001111000.00000000000111441100.00000000001444444410.00000000014444444411.00000000144441444441.00000000144414444441.00000001444414444441.00000001444414444441.00000001444411444441.00000001444441111115.00000001444444444466.01110001144444444466.01411100144444411111.01455410114444144441.00145541011444444441.00014554144444444441.01111455444441144441.14555114444444114441.01455551444444414415.00111111144564441100.00000000014444441000.00000000014444441000.00000000001114510000.00000000000011100000","00000000000000000000110.00000000000115000001510.00000000001445100014311.00000000014444100143151.00001111144624101431441.00015555144444114314410.00155111444444441144100.01411445444444444441000.14411555444444444410000.11115551111444411100000.00155511001444441000000.01451100014444441000000.01110000144444441000000.00000000144444111100000.00000001444441441410000.00000001444441444141000.00000000144444444141000.00000000144444444144100.00000000014444444414100.00000000014441111414510.00000001141111001441110.00000014441000000144100.00000014441000000014510.00000001110000000001110","000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013316331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000015500000000000.000000001133310000000000.000000013333331000000000.000000013316331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","00000000000001111000.00000000000111441100.00000000001444444410.00000000014444444411.00000000144441444441.00000000144414444441.00000001444414444441.00000001444414444441.00000001444411444441.00000001444441111115.00000001444444444466.01110001144444444466.01411100144444411111.01455410114444144441.00145541011444444441.00014554144444444441.01111455444441144441.14555114444444114441.01455551444444414415.00111111144514441100.00000000014444441000.00000000014444441000.00000000001114510000.00000000000011100000","00000000000001111000.00000000000111441100.00000000001444444410.00000000014444444411.00000000144441444441.00000000144414444441.00000001444414444441.00000001444414444441.00000001444411444441.00000001444441111115.00000001444444444466.01110001144444444466.01411100144444411111.01455410114444144441.00145541011444444441.00014554144444444441.01111455444441144441.14555114444444114441.01455551444444414415.00111111144524441100.00000000014444441000.00000000014444441000.00000000001114510000.00000000000011100000","000000000015500000000000.000000001166610000000000.000000016666661000000000.000000016615661011100000.000011166666661166610011.001166666666666666661161.016555666666666666666611.165556661166666666666610.155561110016666666111111.111110000001666661666161.000000000001166661666661.000000000000166666666661.000000000000166666666661.000000000000166666666661.000000000000166666666661.000000000000016666666661.000000000000001666666661.000000000000000166666610.000000000000000011111110.000000000000000000001661.000000000000000000016661.000000000000000000016611.000000000000000000001110.000000000000000000000000","000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000011100000.000000000000000114410111.000111000111101444441551.011455111444414441441441.145555544444414414114441.011111444615441444444111.000000114444561444444441.000000114444561444444441.011111444615441444444111.145555544444414414114441.011455111444414441441441.000111000111101444441551.000000000000000114410111.000000000000000011100000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000"];
    var designs = ["000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013315331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013351331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013361331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","00000000000001111000.00000000000111441100.00000000001444444410.00000000014444444411.00000000144441444441.00000000144414444441.00000001444414444441.00000001444414444441.00000001444411444441.00000001444441111115.00000001444444444466.01110001144444444466.01411100144444411111.01455410114444144441.00145541011444444441.00014554144444444441.01111455444441144441.14555114444444114441.01455551444444414415.00111111144514441100.00000000014444441000.00000000014444441000.00000000001114510000.00000000000011100000","00000000000000000000110.00000000000115000001510.00000000001445100014311.00000000014444100143151.00001111144624101431441.00015555144444114314410.00155111444444441144100.01411445444444444441000.14411555444444444410000.11115551111444411100000.00155511001444441000000.01451100014444441000000.01110000144444441000000.00000000144444111100000.00000001444441441410000.00000001444441444141000.00000000144444444141000.00000000144444444144100.00000000014444444414100.00000000014441111414510.00000001141111001441110.00000014441000000144100.00000014441000000014510.00000001110000000001110","000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000011100000.000000000000000114410111.000111000111101444441551.011455111444414441441441.145555544444414414114441.011111444615441444444111.000000114444561444444441.000000114444561444444441.011111444615441444444111.145555544444414414114441.011455111444414441441441.000111000111101444441551.000000000000000114410111.000000000000000011100000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000.000000000000000000000000","000000000015100000000000.000000001133310000000000.000000013333331000000000.000000013316331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000015500000000000.000000001133310000000000.000000013333331000000000.000000013316331011100000.000011133333331133310011.001133333333333333331131.013555333333333333333311.135553331133333333333310.155531110013333333111111.111110000001333331333131.000000000001133331333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000133333333331.000000000000013333333331.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001331.000000000000000000013331.000000000000000000013311.000000000000000000001110.000000000000000000000000","00000000000000111000.00000000000111131100.00000000001333334410.00000000013344444431.00000000133441444431.00000000133414444431.00000001334414444431.00000001344414444431.00000001344431111431.00000001344433333131.00000001344444433331.01110001334444444431.01411100134444411131.01455410133444133331.00145541012344444431.00014554113444444431.01111455444444144431.14554114444444414431.01455551444614414410.00111111144444441100.00000000014444441000.00000000014444441000.00000000001114510000.00000000000011100000","00000000000001111000.00000000000111441100.00000000001444444410.00000000014444444411.00000000144441444441.00000000144414444441.00000001444414444441.00000001444414444441.00000001444411444441.00000001444441111115.00000001444444444466.01110001144444444466.01411100144444411111.01455410114444144441.00145541011444444441.00014554144444444441.01111455444441144441.14555114444444114441.01455551444444414415.00111111144514441100.00000000014444441000.00000000014444441000.00000000001114510000.00000000000011100000","000000000015500000000000.000000001166610000000000.000000016666661000000000.000000016615661011100000.000011166666661166610011.001166666666666666661161.016555666666666666666611.165556661166666666666610.155561110016666666111111.111110000001666661666161.000000000001166661666661.000000000000166666666661.000000000000166666666661.000000000000166666666661.000000000000166666666661.000000000000016666666661.000000000000001666666661.000000000000000166666610.000000000000000011111110.000000000000000000001661.000000000000000000016661.000000000000000000016611.000000000000000000001110.000000000000000000000000","000000000015500000000000.000000001144410000000000.000000014444431000000000.000000014441431011100000.000011144444441133310011.001144554444444334441141.014555443344444444444411.145543331133444444333410.155331110013344443111111.111110000001344441444141.000000000001134441444441.000000000000134444444441.000000000000134444444441.000000000000133444444441.000000000000133344444441.000000000000013334443341.000000000000001333333331.000000000000000133333310.000000000000000011111110.000000000000000000001441.000000000000000000014431.000000000000000000013311.000000000000000000001110.000000000000000000000000","000000000012100000000000.000000001155510000000000.000000015555551000000000.000000015561551011100000.000011155555551155510011.001155555555555555551151.015555555555555555555511.155555551155555555555510.155551110015555555111111.111110000001555551555151.000000000001155551555551.000000000000155555555551.000000000000155555555551.000000000000155555555551.000000000000155555555551.000000000000015555555551.000000000000001555555551.000000000000000155555510.000000000000000011111110.000000000000000000001551.000000000000000000015551.000000000000000000015511.000000000000000000001110.000000000000000000000000","000000000012100000000066.000000001155510000000000.000000015555551000000000.000000015561551011100000.000011155555551155510011.001155555555555555551151.015555555555565555655511.155555551155555565555510.155551110015555555111111.111110000001565551555151.000000000001155551565551.000000000000155555555551.000000000000165655565551.000000000000155555555651.000000000000155555555551.000000000000015555555551.000000000000001556556551.000000000000000155555510.000000000000000011111110.000000000000000000001551.000000000000000000015651.000000000000000000015511.000000000000000000001110.000000000000000000000000","000000000012100000000056.000000001155510000000000.000000011155551000000000.000000011161551011100000.000011155555551151510011.001115555551555515551151.015555155555555155555511.151155551151551555555510.151551110015551555111111.111110000001551551555551.000000000001151551555551.000000000000151555555151.000000000000115515551551.000000000000155515515551.000000000000155515555151.000000000000015115155551.000000000000001555555151.000000000000000155555510.000000000000000011111110.000000000000000000001151.000000000000000000015151.000000000000000000015511.000000000000000000001110.000000000000000000000000","000000000012100000000056.000000001155510000000000.000000011155551000000000.000000011161551011100000.000011155555551151510011.001115555551555515551151.015555155555555155555511.151155551151551555555510.151551110015551555111111.111110000001551551555551.000000000001151551555551.000000000000151555555151.000000000000115515551551.000000000000155515515551.000000000000155515555151.000000000000015115155551.000000000000001555555151.000000000000000155555510.000000000000000011111110.000000000000000000001151.000000000000000000015151.000000000000000000015511.000000000000000000001110.000000000000000000000000"];
	//var designs = ["000000000000000000111000.000000000000000011633100.000000000000011113433100.000000000000133333411000.000000000001344444441100.000000000013344444444111.111000000133446644444431.154110000133446464444431.155541001334444646664431.014544001334446464444131.111554101333446644111331.151455101111344444333441.155144414441134444444441.145414444444133444444441.015541444444413444444441.014554444444413444414141.001441344444441444414141.000111344544441441114141.000000135134441141014141.000000134544413311001110.000000013444411331000000.000000001134301331000000.000000000011501111000000.000000000000000000000000","000000000000000000111000.000000000000000011633100.000000000000011113433100.000000000000134444441000.000000000001344441144100.000000000013444441414411.111000000134411114144431.154110000134444441414431.155541001334444441144431.014544001334444444444131.111554101333444443111331.151455101111444444333441.155144414441144444444441.145414444444134444444441.015541444444413444444441.014554444444413444414141.001441344444441444414141.000111344444441441114141.000000134124441141014141.000000134444413311001110.000000013444411331000000.000000001134201331000000.000000000015201111000000.000000000000000000000000","000000000000000000111000.000000000000000011633100.000000000000011113433100.000000000000133333411000.000000000001344444441100.000000000013346464644111.111000000133444464444431.154110000133446666644431.155541001334444464444431.014544001334446464644131.111554101333444444441331.151455101111344444433441.155144414441134444444441.145414444444133444444441.015541444444413444444441.014554444444413444414141.001441344444441444414141.000111344444441441114141.000000134124441141014141.000000134444413311001110.000000013444411331000000.000000001134201331000000.000000000011501111000000.000000000000000000000000","000000000000000000111000.000000000000000011633100.000000000000011113433100.000000000000133333411000.000000000001344444441100.000000000013344222444111.111000000133444442444431.153110000133444422244431.155531001334444442444431.013533001334444444444131.111553101333444444111331.151355101111344244333441.155133314441134244444441.145414444444134222244441.015541444444414444444441.014554444444413444414141.001441344444441444414141.000111344544441441115151.000000135124441141015151.000000134544413311001110.000000013444411551000000.000000001134501551000000.000000000011501111000000.000000000000000000000000","000000000000000000111000.000000000000000011633100.000000000000011113433100.000000000000133333411000.000000000001344444441100.000000000013344664444111.111000000133444656444431.154110000133444655644431.155541001334444633644431.014544001334444633644131.111554101333444655641331.151455101111344656443441.155144414441134664444441.145414444444133444444441.015541444444413444444441.014554444444413444414141.001441344444441444414141.000111344444441441114141.000000134124441141014141.000000134444413311001110.000000013444211331000000.000000001134201331000000.000000000011501111000000.000000000000000000000000","000000000000000000111000.000000000000000011633100.000000000000011113433100.000000000000133333411000.000000000001344444441100.000000000013344222444111.111000000133444444244431.154110000133422244244431.155541001334422442444431.014544001334424224444131.111554101333444444111331.151455101111344444444441.155144414441134444444441.145414444444133444444441.015541444444413444444441.014554444444413444414141.001441344444441444414141.000111344444441441114141.000000134124441141014141.000000134444413311001110.000000013444411331000000.000000001134501331000000.000000000011501111000000.000000000000000000000000","000000000000000000111000.000000000000000011166100.000000000000011113366100.000000000000133333411000.000000000001333334441100.000000000013333344444111.111000000133333344444431.152110000133333444444331.155521001333334441333311.012522001333334441333131.111552101333333444111431.151255101111333444444331.155122212221333344444341.125212222422133344444311.015521444442213344444316.012552444444213344444166.001221444444221344444311.000111445544421341143331.000000145634421141013331.000000145544413341001155.000000014444411341000000.000000001144101551000000.000000000011501111000000.000000000000000000000000","000000000000000000111000.000000000000000011144100.000000000000011114444100.000000000000144442411000.000000000001444244441100.000000000014444444444111.111000000144444444244441.153110000142444444442441.155531001444444441444411.013543001444442441444141.111553101444444444111441.131353101111444444444441.153133314441444442442441.135313343444142444444411.013531344434414444244416.013553434444314444444166.001331444444441444444411.000111344544341441144451.000000145624441141014551.000000144544414441001150.000000014444411441000000.000000001144101551000000.000000000011501111000000.000000000000000000000000","000000000000000000111000.000000000000000011136100.000000000000011114443200.000000000000144444411000.000000000001433444441100.000000000014443344444111.111000000144443334444431.154110000144443344444431.155561001444433441444411.016566001444444441444141.111556101444444444111441.156655101111444444444441.156166666441444444444441.165616664444144444444411.015561644444414444444416.016556644444414444444166.001661644444441444444411.000111644344441441144441.000000143624441141013551.000000144344413441001155.000000014444411551000000.000000001144301551000000.000000000011501111000000.000000000000000000000000","000000000000000000111000.000000000000000011133100.000000000000011114443100.000000000000144445411000.000000000001455555541100.000000000015555555544111.111000000145555555554441.151110000145555555554441.155511001445555551454411.014511001445555551444141.111554101444555555111441.151151101111555555554441.155111115551555555554441.115111444455155555554411.015511444555515554444416.011551444445555554444166.001111444444455544444411.000111444534441441144441.000000145133441141014451.000000144534414441001155.000000014444411441000000.000000001144301551000000.000000000011501111000000.000000000000000000000000","000000000000000000111000.000000000000000011144100.000000000000011114444100.000000000000145555411000.000000000005555545441100.000000000055556664444111.111000000155546664333341.154110000145546643333341.155541001455446433333311.014544001455436433333151.111554101454336433111551.151455101111336444445551.155144414341444555555551.145414444444145555555411.015541444344414555554416.014554444443414445554166.001441434444441444544411.000111444444441441144451.000000144264341141014551.000000144444414441001160.000000014444411441000000.000000001144601651000000.000000000011501111000000.000000000000000000000000","000000000000000000112000.000000000000000011155100.000000000000011114415100.000000000000144444411000.000000000001444444441100.000000000044444444444111.111000000435353535344451.153110000153355555544451.155531001453533535344411.013533001445553555544141.111553101444535355341441.151355101111445535544441.155133313331444353544441.135313333433144453344411.015531444443314435444416.013553444444314444444166.001331444444331444444411.000111334444431441144441.000000134264431141014451.000000134444414441001150.000000033334411441000000.000000001134551551000000.000000000011301111000000.000000000000000000000000","000000000000000000111000.000000000000000011144100.000000000000011114444100.000000000000144444411000.000000000001444444444100.000000000014444444444111.111000000144444444444441.154110000144434441444141.155541001444442241441441.014544001444442222224441.111554101444442241441441.151455101111434441444141.155144414441444444444441.145414444444144444444411.015541444444414444444416.014554444444414444444166.001441444444441444444411.000111444444441441144441.000000144264441141014441.000000144444414441001150.000000014444411441000000.000000001144101551000000.000000000011501111000000.000000000000000000000000","000000000000000000111000.000000000000000011155100.000000000000011114445100.000000000000144444411000.000000000001444444441100.000000000014444444444111.111000000144444222224451.155110000144444244444451.155551001444444244444411.015555001444444244444141.111555101444444244411441.151555101111444221444441.155155514441444443444441.155515544444144443444411.015551444444414343434416.015555444444414435344166.001551444444441443444411.000111444444441444444441.000000144264441141014551.000000144444414441001150.000000014444411441000000.000000001144101551000000.000000000011501111000000.000000000000000000000000","000000000000000000111000.000000000000000011135100.000000000000011113335100.000000000000144443311000.000000000001444444441100.000000000014444144444111.111000000144441314444441.154110000144414341444441.155541001444122222144411.014544001444414342444131.111554101444441314411331.151455101111444144443331.155144414441444444433331.145414444444144444333311.015541444444414444333316.014554444444414433333166.001441444444441333333311.000111444444441331133341.000000144624441131013351.000000144444413331001150.000000014444411331000000.000000001144101551000000.000000000011501111000000.000000000000000000000000","000000000000000000111000.000000000000000011144100.000000000000011114444100.000000000000144446441000.000000000001444446444100.000000000014444446664111.111000000144444464444451.154110000144644644444451.155541003444646444444411.014544003444644444444141.111554103444666644441441.151455103555444444444451.155144414443444444444451.145414444443344444444411.015541444444334444444416.014554444444434444444166.001441444444433444444411.000111444434443441144441.000000144634443341014451.000000144434414441001150.000000014444411441000000.000000001144101551000000.000000000011501111000000.000000000000000000000000","000000000000000000111000.000000000000000011133100.000000000000011164443100.000000000000144444411000.000000000001446444441100.000000000014444464644111.111000000144444444444451.153110000164644644444451.155541001444444441446411.013544001446444441444141.111554101444444464111441.151455101111444444444451.155144414441446444446451.145414442424144464444411.015541444444414444444416.014554444442414444644166.001441444444421444444411.000111443344221441144451.000000143254221141014451.000000143344214441001150.000000014444411441000000.000000001144101551000000.000000000011501111000000.000000000000000000000000"]
    function RGBToHSL(r, g, b) {
	if (Array.isArray(r)) {
	    g = r[1];
	    b = r[2];
	    r = r[0];
	}
	var r = r / 255;
	var g = g / 255;
	var b = b / 255;
	var cMax = Math.max(r, g, b);
	var cMin = Math.min(r, g, b);
	var delta = cMax - cMin;
	if (delta == 0) {
	    var h = 0;
	} else if (cMax == r) {
	    var h = 60 * (((g - b) / delta) % 6);
	} else if (cMax == g) {
	    var h = 60 * ((b - r) / delta + 2);
	} else if (cMax == b) {
	    var h = 60 * ((r - g) / delta + 4);
	}
	if (h < 0) {
	    h += 360;
	}
	var l = (cMax + cMin) / 2;

	if (delta == 0) {
	    var s = 0;
	} else {
	    var s = delta / (1 - Math.abs(2 * l - 1));
	}

	return [h, s, l]
    }

    function HSLToRGB(h, s, l) {
	if (Array.isArray(h)) {
	    s = h[1];
	    l = h[2];
	    h = h[0];
	}
	var c = (1 - Math.abs(2 * l - 1)) * s;
	var x = c * (1 - Math.abs((h / 60) % 2 - 1));
	var m = l - c / 2;
	if (h >= 0 && h < 60) {
	    var r = c,
		g = x,
		b = 0;
	} else if (h >= 60 && h < 120) {
	    var r = x,
		g = c,
		b = 0;
	} else if (h >= 120 && h < 180) {
	    var r = 0,
		g = c,
		b = x;
	} else if (h >= 180 && h < 240) {
	    var r = 0,
		g = x,
		b = c;
	} else if (h >= 240 && h < 300) {
	    var r = x,
		g = 0,
		b = c;
	} else if (h >= 300 && h < 360) {
	    var r = c,
		g = 0,
		b = x;
	}
	r = Math.round((r + m) * 255);
	g = Math.round((g + m) * 255);
	b = Math.round((b + m) * 255);
	return [r, g, b];
    }

    function RGBToHex(arr) {
	var r = arr[0],
	    g = arr[1],
	    b = arr[2];
	return "#" + ("0" + r.toString(16)).slice(-2) + ("0" + g.toString(16)).slice(-2) + ("0" + b.toString(16)).slice(-2);
    }

    function derivePalette(r, g, b, invert) {
	var hsl = RGBToHSL(r, g, b);

	var h = hsl[0];
	var s = hsl[1];
	var l = hsl[2];
	var hx = h % 360;
	var hy = (h + 320) % 360;

	var c1 = HSLToRGB(hx, 1, 0.1);
	if (invert) {
	    var c4 = HSLToRGB(hx, 1, 0.2);
	    var c5 = HSLToRGB(hx, 1, 0.45);
	    var c2 = HSLToRGB(hx, 1, 0.7);
	    var c3 = HSLToRGB(hy, 1, 0.8);
	} else {
	    var c2 = HSLToRGB(hx, 1, 0.2);
	    var c3 = HSLToRGB(hx, 1, 0.45);
	    var c4 = HSLToRGB(hx, 1, 0.7);
	    var c5 = HSLToRGB(hy, 1, 0.8);

	}


	return [
	    null,
	    RGBToHex(c1),
	    RGBToHex(c2),
	    RGBToHex(c3),
	    RGBToHex(c4),
	    RGBToHex(c5)
	];
    }

	function random(max) {
		return Math.floor(Math.random() * max) + 1;
	}
		
    function hexToBytes(hex){
	var result = []
	for(var i = 0; i < hex.length; i+=2){
	    result.push(parseInt(hex.slice(i, i+2),16));
	}
	return result;
    }

    var mooncatparser = function (catId){
	if(catId.slice(0,2) == "df"){
		
	    catId = catId.slice(2);
	}
	var bytes = hexToBytes(catId);
	var genesis = bytes[0],
	    k = bytes[1],
	    r = bytes[2],
	    g = bytes[3],
	    b = bytes[4];

	var size = size || 10;
	var invert = k >= 128;
	k = k % 128;
	k = k % (designs.length-1);

	//k = random(designs.length-1); // Number of the Cat

	var design = designs[k].split(".");
	var colors;
	if(genesis){
		k = random(genesis_design.length-1);
		design = genesis_design[k].split(".");

	    if(k % 2 === 0 && invert || k % 2 === 1 && !invert){
		colors = [null, "#555555", "#d3d3d3", "#ffffff", "#000000", "#ff9999"];
	    }else{
		colors = [null, "#555555", "#222222", "#111111", "#000000", "#ff9999"];
	    }
	}else{
	    colors = derivePalette(r, g, b, invert);
	}

	return design.map(function(row){
	    return row.split("").map(function(cell){
		return colors[cell];
	    })
	})
    }

    mooncatparser.noConflict = function(){
	root.mooncatparser = prev_mooncatparser;
	return mooncatparser;
    }

    if( typeof exports !== 'undefined' ) {
	if( typeof module !== 'undefined' && module.exports ) {
	    exports = module.exports = mooncatparser;
	}
	exports.mooncatparser = mooncatparser;
    } else {
	root.mooncatparser = mooncatparser;
    }
}).call(this);
